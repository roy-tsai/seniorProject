
<!DOCTYPE html>
<html>
<head>
<style>
	body {
		background-color: #fff;
		color: #111;
		margin: 0px;
		overflow: hidden;
		font-family: Monospace;
		font-size: 20px;
		position: absolute;
	}
	#info {
		position: absolute;
		top: 0px; width: 100%;
		
		padding: 5px;
		text-align: center;
		color: #ffff00
	}
	a {color: #00ffff}
	strong {color:red}
</style>
</head>

<body> 

<h1 style="text-align:center"> Project: LR game </h1>
<hr>
<div id="canvas" style="float:left; 
margin:3px; width:60vw; height:60vw"></div>
<div style="float:left; margin-left: 10px; width:32vw;">Menu:
    <button id="turn" style="width:100%">start</button>
	<br/>
    <br/>
	<button id="R-N" style="width:100%">Random</button>
    <br/>
    <br/>
    <button id="WvsL" style="width:100%">WINS</button>
    <p id='greeting'></p>
</div>
<script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
<script src="js/r69/three.min.js"></script>
<script src="js/OrbitControls.js"></script>

<script>

var time = 0;
var turn = false, change = false;
var scene, renderer, camera, controls;   

var raycaster;
var mouse = new THREE.Vector2();

var left_box, right_box;
var angle_l = 0, angle_r = 0;
var ChooseL = false, ChooseR = false, stop = true;
var InLeft = false, InRight = false;
var left_count = 0, right_count = 0;
	
	
	
init();
animate();

/*function clearlog()
{
	localStorage.setItem ("left_count", 0);
	localStorage.setItem ("right_count", 0);
	left_count = right_count = 0;
}*/

function log()
{
	var left_so_far, right_so_far;
	var WINS = left_so_far/(left_so_far + right_so_far)*100;
	left_so_far = localStorage.getItem ("left_count");
	right_so_far = localStorage.getItem ("right_count");
	alert ("Win: " + left_so_far + "   vs   Lose: " + right_so_far + "    WINS: " + WINS + "%");
}


function spin (which) 
{
	if (which == "left") {
		ChooseL = true;
		localStorage.setItem ("left_count", ++left_count);
	}
	else {
		ChooseR = true;
		localStorage.setItem ("right_count", ++right_count);
	}
}

function init() {
    var ww = $("#canvas").innerWidth();
    var hh = $("#canvas").innerHeight();	

	left_count = localStorage.getItem ("left_count");
	right_count = localStorage.getItem ("right_count");
	

    scene = new THREE.Scene();

	camera = new THREE.PerspectiveCamera (45, ww/hh, 1, 10000);
	camera.position.x = 0;
	camera.position.y = 160;
	camera.position.z = 400;
	camera.lookAt (new THREE.Vector3(0,0,0));

	
    renderer = new THREE.WebGLRenderer();
    renderer.setSize(ww, hh);
    renderer.setClearColor(0x888888);
	document.body.appendChild (renderer.domElement);
	

    var gridXZ = new THREE.GridHelper(100, 10);
    gridXZ.setColors(new THREE.Color(0xff0000), new THREE.Color(0xffffff));
    scene.add(gridXZ);
	
	light();
	LR();
	
    controls = new THREE.OrbitControls(camera, renderer.domElement);
	
	window.addEventListener ('resize', onWindowResize, false);	

	raycaster = new THREE.Raycaster();
	document.addEventListener( 'mousedown', onDocumentMouseDown, false );
	
    $("#canvas").append(renderer.domElement);
}

$("#turn").click(function () {
	turn = !turn;
	stop = !stop;
    if (turn){
        $("#turn").html ("Game Time!");
	}
	else{
        $("#turn").html ("Start");
	}
});

$("#R-N").click(function () {
    change = !change;
    if (change)
        $("#R-N").html ("2-gram");
    else
        $("#R-N").html ("Random");
});

$("#WvsL").click(function () {
   log();
});

function LR(){
	var ball_geom = new THREE.SphereGeometry (20,32,32);
	var ball_mat = new THREE.MeshLambertMaterial ({color: 0xff2211});
	left_ball = new THREE.Object3D();
	left_ball.add( new THREE.Mesh (ball_geom, ball_mat));
	left_ball.position.set (-50,10,0);
	left_ball.name = "leftB";
	scene.add (left_ball);
		

	right_ball = new THREE.Object3D();
	right_ball.add( new THREE.Mesh (ball_geom, ball_mat));
	right_ball.position.set (50,10,0);
	right_ball.name = "rightB";
	scene.add (right_ball);

}

function light(){

	var pointLight = new THREE.PointLight (0xffffff);
	pointLight.position.set (0,300,200);
	scene.add (pointLight);

	var ambientLight = new THREE.AmbientLight (0x111111);
	scene.add(ambientLight);
}

function onDocumentMouseDown( event ) {
	var ww = $("#canvas").innerWidth();
    var hh = $("#canvas").innerHeight();
	// PICKING DETAILS: 
	// convert mouse.xy = [-1,1]^2 (NDC)
	// unproject (mouse.xy, 1) to a point on the far plane (in world coordinate)
	// set raycaster (origin, direction)
	// find intersection objects, (closest first) 
	// each record as
	// [ { distance, point, face, faceIndex, object }, ... ]
	event.preventDefault();
	mouse.x = ( event.clientX / ww ) * 2 - 1;
	mouse.y = - ( event.clientY / hh ) * 2 + 1;
	console.log(mouse.x);
	// find intersections
	var vector = new THREE.Vector3( mouse.x, mouse.y, 1 ).unproject( camera );
	raycaster.set( camera.position, vector.sub( camera.position ).normalize() );
	var intersects = raycaster.intersectObjects( scene.children );
	if ( intersects.length > 0 ) {
		if (intersects[0].object.name === "leftB") spin ("left");
		else if (intersects[0].object.name === "rightB") spin ("right");
	}
	
}

function ModeRandom(){
	var x = Math.random();
	if( x >= 0.5 ) InLeft = true;
	else InRight = true;
	
	var ball_geom = new THREE.SphereGeometry (20,32,32);
	var Texture = new THREE.ImageUtils.loadTexture( 'image/get.png' );
	var GetMesh =  new THREE.Mesh (ball_geom, new THREE.MeshPhongMaterial( { map: Texture } ));
	
	
	if (InLeft) {
		left_ball.add( GetMesh );
		if (angle_l > Math.PI) {
			angle_l = 0.0;
			InLeft = false;
		}
	}
	if (InRight) {
		right_ball.add( GetMesh );
		if (angle_r > Math.PI) {
			angle_r = 0.0;
			InRight = false;
		}
	}
	

}


function animate()
{
	//ModeRandom();
	if(time < 3 && !stop){
		time += 0.05;
		angle_l += 0.2; angle_r += 0.2;
		left_ball.translateOnAxis (new THREE.Vector3(0,0,1), 20)	
		left_ball.rotation.y = angle_l;
		right_ball.translateOnAxis (new THREE.Vector3(0,0,1), -20)	
		right_ball.rotation.y = angle_r;
	}
	else if(time >= 3){
		left_ball.position.set (-50,10,0);
		right_ball.position.set (50,10,0);
		angle_l = 0.0;
		angle_r = 0.0;
		time = 0;
		stop = !stop;
	}
	
	if (ChooseL) {
		angle_l += 0.1; 
		if (angle_l == Math.PI) {
			angle_l = 0.0;
			ChooseL = false;
		}
	}
	if (ChooseR) {
		angle_r += 0.1;
		if (angle_r > Math.PI) {
			angle_r = 0.0;
			ChooseR = false;
		}
	}
		//left_ball.translateX ( 10 );	
		left_ball.rotation.y = angle_l;
		//right_ball.translateX ( -10 );	
		right_ball.rotation.y = angle_r;

	requestAnimationFrame ( animate );  // timer callback
	update();
	render();  // display callback
}

function update()
{
	controls.update();
}


function onWindowResize() {
    var ww = $("#canvas").innerWidth();
    var hh = $("#canvas").innerHeight();

    camera.aspect = ww / hh;
    camera.updateProjectionMatrix();
    renderer.setSize(ww, hh);
}

function animate2() {
    if (turn) angle += 0.01;
    mesh.rotation.y = angle;

    $("#angle").val(angle.toFixed(2));

    controls.update();
    requestAnimationFrame(animate);
    render();
}

function render() {
    renderer.render(scene, camera);
}
</script>
</body>

</html>